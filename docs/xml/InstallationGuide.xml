<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//UR1//DTD docbookAllegeEsup//FR"
"http://www.esup-portail.org/consortium/espace/docbook/xxe/dtd/docbook_allege_esup.dtd">
<article lang="FR">
  <title>Esup Lecture Portlet - Installation Guide</title>

  <articleinfo>
    <mediaobject>
      <imageobject>
        <imagedata fileref="media/logoCLectureV1.jpg"></imagedata>
      </imageobject>
    </mediaobject>

    <abstract>
      <para>XML aggregation portlet. Use French word “Lecture” in his
      name.</para>
    </abstract>

    <author>
      <firstname>Bourges</firstname>

      <surname>Raymond - Bouteille Gwénaëlle</surname>

      <affiliation>
        <orgname><ulink url="http://www.univ-rennes1.fr">University of Rennes
        1</ulink></orgname>
      </affiliation>
    </author>

    <revhistory>
      <revision>
        <revnumber>1.0</revnumber>

        <date>29/11/2006</date>

        <revdescription>
          <para>First version of the installation Guide</para>
        </revdescription>
      </revision>
    </revhistory>
  </articleinfo>

  <section>
    <title>TODO (RB) Dispatch in installation and technical
    configuration</title>

    <para>To configure this application you have to adapt some configuration
    files. Each time you will find a
    &lt;fileName&gt;-example.&lt;extension&gt; example file that you can copy
    to &lt;fileName&gt;.&lt;extension&gt; before adapting. adapt
    build.properties. Adapt properties/exceptionHandling/exceptionHandlin.xml.
    Note : By default, exception reports are also sent to an archived bugs
    mailing list, accessible to the developers of the project only. This
    feature is used to be warned of all the possible exceptions occuring on
    the applciation anywhere; this way, most bugs can be corrected as soon as
    they happen. If you do not want the exceptions to be sent to this list,
    you can manually set property doNotSendExceptionReportsToDevelopers to
    true. Adapt properties/smtp/smtp.xml
    properties/dao/hibernate/hibernate.cfg.xml ant test-config ant test-smtp
    ant test-database ant init adapt properties/logging/log4j.properties Adapt
    properties/mappings.xml and properties/esup-lecture.xml ant deploy</para>
  </section>

  <section>
    <title>Installation</title>

    <note>
      <para>For this version 0.5 installation instructions are simplified
      because we don't use esup-commons standard installation mode.</para>
    </note>

    <itemizedlist>
      <listitem>
        <para>Download LecturePortlet.zip from <ulink
        url="https://sourcesup.cru.fr/frs/?group_id=251">the project
        site</ulink></para>
      </listitem>

      <listitem>
        <para>Unzip LecturePortlet.zip somewhere on your tomcat server</para>

        <para><note>
            <para>Do not use uPortal deployPortletApp ant target ! If you do
            this you corrupt the web.xml file of the application.</para>
          </note></para>
      </listitem>

      <listitem>
        <para>Configure a new context in your application server. For example
        with Tomcat create a LecturePortlet.xml file in the Toncat
        conf/Catalina/localhost subfolder with content like this:</para>

        <para><screen>&lt;Context path="/LecturePortlet"
        docBase="D:/esupdev/esupdev-2.5-esup-2/uPortal-quick-start/webapps/LecturePortlet"&gt;
        &lt;/Context&gt;</screen></para>
      </listitem>

      <listitem>
        <para>Configure your portal to reference this portlet. For example
        with uPortal you can use cannel manager as shown here:</para>

        <mediaobject>
          <imageobject>
            <imagedata fileref="media/channelManager.gif"></imagedata>
          </imageobject>
        </mediaobject>

        <para><note>
            <para>Portlet definition ID is very important. Here it is
            <emphasis>LecturePortlet.esup-lecture.</emphasis> LecturePortlet
            must be equal to the appliation server context name and
            esup-lecture must be equal to the portlet-name of the
            WEB-INF/portlet.xml file.</para>
          </note></para>
      </listitem>
    </itemizedlist>
  </section>

  <section>
    <title>Configuration</title>

    <section>
      <title>Technical configuration</title>

      <para><screen>TO COMPLETE !!!</screen> Adapt to your environment these
      configuration files of WEB-INF/classes/properties:</para>

      <itemizedlist>
        <listitem>
          <para>ldap/ldap.xml</para>
        </listitem>

        <listitem>
          <para>smtp/smtp.xml</para>
        </listitem>
      </itemizedlist>
    </section>

    <section>
      <title>Content configuration</title>

      <para>To adapt to your environment, write these configuration files of
      WEB-INF/classes/properties :</para>

      <itemizedlist>
        <listitem>
          <para><command>esup-lecture.xml</command> : main configuration file.
          Contexts and CategoryProfiles definition.</para>

          <para>It also deals with <command>&lt;category&gt;.xml</command> :
          remote xml file referecend by CategoryProfiles.</para>
        </listitem>

        <listitem>
          <para><command>mappings.xml</command> : declarations about xslt
          transformation for interface display</para>
        </listitem>

        <listitem>
          <para><command>portlet.xml</command> : it needs declaration of
          portal user attributes used by Lecture Channel</para>
        </listitem>
      </itemizedlist>

      <note>
        <para>XML Elements or attributes not explained here (but in dtd)
        implements features that are not yet supported.</para>
      </note>

      <section>
        <title>esup-lecture.xml and &lt;category&gt;.xml</title>

        <para>it describes contexts, category profiles and userId definition.
        Here is the structure of this file (for more information, look at dtd
        <command>lecture-config.dtd</command>) :</para>

        <itemizedlist>
          <listitem>
            <para>element <command>channelConfig</command> in
            <command>esup-lecture.xml</command> :<programlisting>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE channelConfig SYSTEM "lecture-config.dtd" &gt;
&lt;channelConfig&gt;
  
  &lt;!-- user attribute to define a user Id --&gt;
  &lt;userId&gt;displayName&lt;/userId&gt;
  
  &lt;!-- contexts definition --&gt;
  &lt;context&gt; ... &lt;/context&gt;
  &lt;context&gt; ... &lt;/context&gt;
  ...

  &lt;!-- category profile definition --&gt;
  &lt;categoryProfile&gt; ... &lt;/categoryProfile&gt;
  &lt;categoryProfile&gt; ... &lt;/categoryProfile&gt;
  ...

&lt;/channelConfig&gt; </programlisting></para>
          </listitem>

          <listitem>
            <para>element <command>userId</command> : it indicates which
            portal user attribute is used to define userId in the channel.
            Portal user attributes used must be defined in the portlet.xml -
            see "portlet.xml" section.</para>
          </listitem>

          <listitem>
            <para>element <command>context</command> :</para>

            <para><programlisting>&lt;context 
   name = "Démonstration Esup-Lecture"
   id = "default"&gt;
   &lt;description&gt;Context de démo&lt;/description&gt; 
   &lt;refCategoryProfile refId="demo1"/&gt;
   &lt;refCategoryProfile refId="demo2"/&gt;
   ...
&lt;/context&gt;</programlisting>Here are defined context
            <emphasis>with:</emphasis></para>

            <para><itemizedlist>
                <listitem>
                  <para><emphasis>id</emphasis> (You can use a specific
                  context by configuring your portlet with a portlet
                  preference. This portlet preference must have a name
                  “context” and a value equals to the id you want for this
                  portlet. If you don't define any context preference for your
                  portlet then context with id “default” is used. With this
                  mechanism you can define many channels with many contexts
                  definitions in your portal environment with just one
                  instance of the portlet. But in uPortal because of a bug
                  (<ulink
                  url="http://www.ja-sig.org/issues/browse/UP-1040">http://www.ja-sig.org/issues/browse/UP-1040</ulink>)
                  you can't use this feature.)</para>
                </listitem>

                <listitem>
                  <para><emphasis>name</emphasis> (displayed on
                  interface)</para>
                </listitem>

                <listitem>
                  <para><emphasis>description</emphasis> (displayed on
                  interface)</para>
                </listitem>

                <listitem>
                  <para><emphasis>eferences on category profile</emphasis>
                  declared in this context (using category profile id)</para>
                </listitem>
              </itemizedlist>You can declare as many category profiles as you
            want in a context. Each category profile must be defined in an
            element <emphasis>categoryProfile</emphasis>. A same
            categoryProfile can be declared in many contexts.</para>
          </listitem>

          <listitem>
            <para>element <command>categoryProfile</command> :</para>

            <para><programlisting>&lt;categoryProfile 
   name="Categorie de démo"
   id="demo1"
   urlCategory="http://partages.univ-rennes1.fr/files/partages/Services/CRI/SI/conf_lecture_gwe_ray/demo1.xml"
   trustCategory="no"
   access="public"
   ttl = "3600" &gt; 
   &lt;visibility&gt; ... &lt;/visibility&gt;
&lt;/categoryProfile&gt;</programlisting>Here are defined category profile
            <emphasis>id</emphasis>, <emphasis>name</emphasis>, and</para>

            <para><itemizedlist>
                <listitem>
                  <para><emphasis>urlCategory</emphasis> : url to get back a
                  xml category file on a remote server -see after for its
                  description-</para>
                </listitem>

                <listitem>
                  <para><emphasis>trustCategory</emphasis> ( yes | no ) : If
                  it is <emphasis>"yes"</emphasis>, visibility rights used are
                  those of remote category and sources. If it is
                  <emphasis>"no"</emphasis>, visibility rights on category and
                  sources used are those of this category profile, defined in
                  <emphasis>visibility</emphasis> element.</para>
                </listitem>

                <listitem>
                  <para><emphasis>access</emphasis> ( public | cas ) : access
                  of the category is <emphasis>public</emphasis> or
                  <emphasis>cas</emphasis> because it needs CAS proxy ticket
                  for authentication -not yet supported -</para>
                </listitem>

                <listitem>
                  <para><emphasis>ttl</emphasis> (second) : time to live of
                  the remote category and its sources</para>
                </listitem>

                <listitem>
                  <para><emphasis>visibility</emphasis> : define group
                  visibility for category referenced by this category profile.
                  It is used only if <emphasis>trustCategory</emphasis> is set
                  to "no"</para>
                </listitem>
              </itemizedlist></para>
          </listitem>

          <listitem>
            <para>element <command>visibility</command> :</para>

            <para><programlisting>&lt;visibility&gt;
   &lt;!-- allowed and autoSubscribed not yet supported --&gt;
   &lt;allowed/&gt;
   &lt;autoSubscribed/&gt;
   &lt;obliged&gt;	
      &lt;group name="local.0"/&gt;
      &lt;group .../&gt; 
      ...
      &lt;regular attribute="sn" value="user" /&gt;
      &lt;regular .../&gt;
      ...
   &lt;/obliged&gt;
&lt;/visibility&gt;</programlisting>In this element, you define 3 groups of
            visibility<itemizedlist>
                <listitem>
                  <para><emphasis>allowed</emphasis> : user inside are
                  "allowed" to subscribe to a category - not yet supported
                  -</para>
                </listitem>

                <listitem>
                  <para><emphasis>autoSubscribed</emphasis> : user inside are
                  auto subscribed to this category and is allowed to
                  unsubscribe - not yet supported -</para>
                </listitem>

                <listitem>
                  <para><emphasis>obliged</emphasis> : user inside are
                  automatically subscribe to this category and can't
                  unsubscribe - for the moment, it is the only way for users
                  to see category -</para>
                </listitem>
              </itemizedlist></para>

            <para>A user is in a visibility group by two ways :</para>

            <para><itemizedlist>
                <listitem>
                  <para><emphasis>group</emphasis> : user is in the portal
                  group referenced by attribute <emphasis>name</emphasis>, in
                  the example : user in in group "local.0" - see "portlet.xml"
                  section.</para>
                </listitem>

                <listitem>
                  <para><emphasis>regular</emphasis> : user check regular, in
                  the example : user value of portal attribute "sn" is "user"
                  - see "portlet.xml" section.</para>
                </listitem>
              </itemizedlist></para>
          </listitem>

          <listitem>
            <para>element <command>category</command> in xml category file
            (describe by dtd <command>category.dtd</command>), provided by
            remote server, requested by <emphasis>urlCategory</emphasis> of
            esup-lecture.xml :</para>

            <para><programlisting>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;!DOCTYPE category SYSTEM "category.dtd"&gt;
&lt;category name="Différents RSS"&gt;
  &lt;description&gt;Très belle description !&lt;/description&gt;
  &lt;sourceProfiles&gt;
    &lt;sourceProfile&gt; ... &lt;/sourceProfiles&gt;
    &lt;sourceProfile&gt; ... &lt;/sourceProfiles&gt;
    ...
  &lt;/sourceProfiles&gt;
  &lt;visibility&gt; ... &lt;/visibility&gt;
&lt;/category&gt;</programlisting>A category has a <emphasis>name</emphasis>
            and a <emphasis>description</emphasis> (displayed on interface),
            and</para>

            <para><itemizedlist>
                <listitem>
                  <para>a list of <emphasis>source profiles</emphasis></para>
                </listitem>

                <listitem>
                  <para><emphasis>visibility</emphasis> : define group
                  visibility for this category. It is used only if
                  <emphasis>trustCategory</emphasis> attribute of referencing
                  <emphasis>categoryProfile</emphasis> is set to "yes" else
                  visibility of category profile is used - optional -</para>
                </listitem>
              </itemizedlist></para>
          </listitem>

          <listitem>
            <para>element <command>sourceProfile</command> in xml category
            file :</para>

            <para><programlisting>&lt;sourceProfile 
  id="un" access="public" name="Incidents techniques Rennes 1" 
  specificUserContent="no" url="http://info.cri.univ-rennes1.fr/rss/rss.php"&gt;
  &lt;visibility&gt; ... &lt;/visibility&gt;

&lt;/sourceProfile&gt;</programlisting>A source profile has an
            <emphasis>id</emphasis>, a <emphasis>name</emphasis> (displayed on
            interface) and <itemizedlist>
                <listitem>
                  <para><emphasis>access</emphasis> ( public | cas ) : access
                  of the source is <emphasis>public</emphasis> or
                  <emphasis>cas</emphasis> because it needs CAS proxy ticket
                  for authentication -not yet supported -</para>
                </listitem>

                <listitem>
                  <para><emphasis>specificUserContent</emphasis> ( yes | no) :
                  if it is "yes", source content is specific to user. If it is
                  "no", source content is the same for every users (If your
                  configure with “yes” then application assumes that content
                  can be deferent for each user (may be because of specific
                  content due to profiling according to authentication). In
                  this case application doesn't use any cache for the source.
                  So be careful before use “yes” for this property.)</para>
                </listitem>

                <listitem>
                  <para><emphasis>url</emphasis> : url to get xml stream of
                  the source</para>
                </listitem>

                <listitem>
                  <para><emphasis>visibility</emphasis> : define group
                  visibility for source refered by this source profile. It is
                  used only if <emphasis>trustCategory</emphasis> attribute of
                  referencing <emphasis>categoryProfile</emphasis> is set to
                  "yes" else visibility category profile is used - optional
                  -</para>
                </listitem>
              </itemizedlist></para>

            <para><note>
                <para>Be carefull to manage unique id for every sources
                profiles defined in categories : application does not yet
                manage it.</para>
              </note></para>
          </listitem>
        </itemizedlist>
      </section>

      <section>
        <title>mappings.xml</title>

        <para><command>mappings.xml</command> : it describes a list of
        mappings used to parse xml stream of a source (see
        <command>mappings.dtd</command> ):</para>

        <para><programlisting>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE mappings SYSTEM "mappings.dtd" &gt;
&lt;mappings&gt;
  &lt;mapping&gt; ... &lt;/mapping&gt;
  &lt;mapping&gt; ... &lt;/mapping&gt;
  ...
&lt;/mappings&gt;</programlisting></para>

        <para>A source is composed of a list of items that will be parsed to
        be all displayed on interface . A mapping is used to define
        <emphasis>xsltFile</emphasis> and <emphasis>itemXPath</emphasis> to
        apply on a source. Sometimes, to define
        <emphasis>itemXPath</emphasis>, namespaces definition are required.
        Here is a mapping :</para>

        <para><programlisting>&lt;mapping 
  sourceURL="http://info.cri.univ-rennes1.fr/rss/rss.php"
  xsltFile="http://partages.univ-rennes1.fr/files/partages/Services/CRI/SI/conf_lecture_gwe_ray/stylesheet01.xsl"
  itemXPath="/rdf:RDF/default:item"&gt;
  &lt;XPathNameSpace prefix="rdf" uri="http://www.w3.org/1999/02/22-rdf-syntax-ns#"/&gt;
  &lt;XPathNameSpace prefix="default" uri="http://purl.org/rss/1.0/" /&gt;
&lt;/mapping&gt;</programlisting><itemizedlist>
            <listitem>
              <para><emphasis>xsltFile</emphasis> : url of the xslt file used
              to parse an item</para>
            </listitem>

            <listitem>
              <para><emphasis>itemXPath</emphasis> : xpath expression to
              locate an item in the xml stream source</para>
            </listitem>

            <listitem>
              <para>element <emphasis>XPathNameSpace</emphasis> : used by
              itemXPath definition - optionnal</para>
            </listitem>

            <listitem>
              <para><emphasis>sourceURL</emphasis> : url of the source, key
              entry of this mapping</para>
            </listitem>

            <listitem>
              <para><emphasis>dtd</emphasis> : dtd of the source, key entry of
              this mapping</para>
            </listitem>

            <listitem>
              <para><emphasis>xmlns</emphasis> : xml namespace of the source,
              key entry of this mapping</para>
            </listitem>

            <listitem>
              <para><emphasis>xmlType</emphasis> : xmlType of the source, key
              entry of this mapping</para>
            </listitem>

            <listitem>
              <para><emphasis>rootElement</emphasis> : rootElement of the
              source,key entry of this mapping</para>
            </listitem>
          </itemizedlist></para>

        <para>Priority to find xslt informations on key entry of a mapping are
        : sourceURL, DTD, xmlType, xmlns and finally rootElement.</para>
      </section>

      <section>
        <title>portlet.xml</title>

        <para>All of portal user attributes used by portlet must be declared
        in the <command>webapp/WEB-INF/portlet.xml</command>, here is an
        example : <programlisting>&lt;user-attribute&gt;
  &lt;description&gt;the username of the portal user&lt;/description&gt;
  &lt;name&gt;username&lt;/name&gt;
&lt;/user-attribute&gt;
&lt;user-attribute&gt;
  &lt;description&gt;the displayName of the portal user&lt;/description&gt;
  &lt;name&gt;displayName&lt;/name&gt;
&lt;/user-attribute&gt;
&lt;user-attribute&gt;
  &lt;description&gt;the sn of the portal user&lt;/description&gt;
  &lt;name&gt;sn&lt;/name&gt;
&lt;/user-attribute&gt;</programlisting></para>
      </section>
    </section>
  </section>
</article>